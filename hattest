import time
from adafruit_servokit import ServoKit

# Initialize the PCA9685 Servo Hat (16 channels)
kit = ServoKit(channels=16)

# Define servo channels
CR_SERVO_1 = 0  # Continuous Rotation Servo 1
CR_SERVO_2 = 4  # Continuous Rotation Servo 2
ANGLE_SERVO = 8  # 180-degree Servo

def test_continuous_servo(channel):
    """Test continuous rotation servo: Forward, Stop, Reverse."""
    print(f"Testing Continuous Rotation Servo on channel {channel}...")

    # Forward rotation
    kit.continuous_servo[channel].throttle = 1
    print("Forward")
    time.sleep(2)

    # Stop
    kit.continuous_servo[channel].throttle = 0
    print("Stop")
    time.sleep(1)

    # Reverse rotation
    kit.continuous_servo[channel].throttle = -1
    print("Reverse")
    time.sleep(2)

    # Stop
    kit.continuous_servo[channel].throttle = 0
    print(f"Servo {channel} test complete.\n")

def test_angle_servo(channel):
    """Test 180-degree servo: Moves to 0°, 90°, 180°, then back."""
    print(f"Testing 180° Servo on channel {channel}...")

    for angle in [0, 90, 180, 90, 0]:
        kit.servo[channel].angle = angle
        print(f"Moved to {angle}°")
        time.sleep(1)

    print(f"Servo {channel} test complete.\n")

# Run tests
try:
    test_continuous_servo(CR_SERVO_1)
    test_continuous_servo(CR_SERVO_2)
    test_angle_servo(ANGLE_SERVO)
    print("All servos tested successfully.")
except KeyboardInterrupt:
    print("\nTest interrupted.")
finally:
    # Stop all servos
    kit.continuous_servo[CR_SERVO_1].throttle = 0
    kit.continuous_servo[CR_SERVO_2].throttle = 0
    kit.servo[ANGLE_SERVO].angle = None  # Release standard servo
